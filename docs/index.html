<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="keywords" content="R, Rstudio, ManagHAL, Réseaux, SBM, LBM, Sciences Ouvertes, HAL">

<title>index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head><body class="fullcontent">\usepackage{geometry}

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>





<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>R, Rstudio, ManagHAL, Réseaux, SBM, LBM, Sciences Ouvertes, HAL</p>
  </div>
</div>

</header>


<section id="managhal-donnees-bibliometriques-reseaux-et-analyses-statistiques-de-reseaux" class="level1">
<h1>{MANAGHAL}, DONNEES BIBLIOMETRIQUES, RESEAUX ET ANALYSES STATISTIQUES DE RESEAUX</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="sciences-ouvertes" class="level3">
<h3 class="anchored" data-anchor-id="sciences-ouvertes">Sciences Ouvertes</h3>
<p>En 2017, AgroParisTech signe l’Appel de Jussieu pour promouvoir la bibliodiversité, visant à maintenir la diversité éditoriale et éviter la domination des grands groupes éditeurs. AgroParisTech, en partenariat avec INRAE, adopte en 2020 une politique de science ouverte (<a href="https://www.agroparistech.fr/recherche/science-ouverte"><span class="citation" data-cites="science-ouverte">AgroParisTech (<span>2024</span>)</span></a>, voir: La science ouverte à AgroParisTech – Politique d’établissement janvier 2020), facilitant la libre diffusion et la transparence des recherches scientifiques. Un exemple concret des principes appliqués suite à l’adoption de cette politique sont les principes FAIR pour la gestion des données de recherche : Findable (facilement trouvable), Accessible (accès clairement défini), Interoperable (intégrable avec d’autres outils), et Reusable (réutilisable avec toutes les informations nécessaires).</p>
<p>Pour atteindre ces objectifs, AgroParisTech crée le 2 janvier 2023 une cellule HAL, dirigée par la Direction de la Recherche, de l’Innovation et du Transfert Technologique, et par la Direction de la Documentation et du Patrimoine Culturel. Cette cellule facilite l’intégration de l’archive ouverte HAL dans la communauté de recherche d’AgroParisTech et veille à la qualité des métadonnées. HAL, ou HyperArticles en Lignes, est “l’archive nationale pour la diffusion ouverte des résultats de recherche” (<a href="https://about.hal.science/"><span class="citation" data-cites="aboutHAL"><span>“About HAL”</span> (<span>n.d.</span>)</span></a>). Elle est une plateforme en ligne développé en 2001 par le Centre pour la communication scientifique directe du CNRS. Cette plateforme dispose d’un API permettant l’extraction et l’analyse des données via des outils comme RStudio. Une explication plus détaillée de cet API et d’une requête HAL sera faite dans la section méthode.</p>
</section>
<section id="managhal-package-r-dextraction-de-données-bibliométrique-hal-et-danalyse-de-réseaux" class="level3">
<h3 class="anchored" data-anchor-id="managhal-package-r-dextraction-de-données-bibliométrique-hal-et-danalyse-de-réseaux">{ManagHAL}, package R d’extraction de données bibliométrique HAL et d’analyse de réseaux</h3>
<p>Les outils pour réaliser des analyses bibliométriques se répartissent en trois catégories, “general bibliometric and performance analysis, science mapping analysis, and libraries” (<a href="https://revista.profesionaldelainformacion.com/index.php/EPI/article/view/epi.2020.ene.03"><span class="citation" data-cites="Moral-Muñoz2020">Moral-Muñoz et al. (<span>2020</span>)</span></a>) ou analyse générale bibliométrique et de performances, analyses par cartographie scientifique et librairies / packages. Le package {managHAL} se trouve dans les troisième et deuxième catégories. Il existe à ce jour d’autres outils d’analyses bibliométriques mais la majorité ne permettent pas de travailler via l’api HAL et se concentrent sur webofscience, scopus, google scholar,… Il existe des outils d’extraction de publications HAL, cependant aucun package R ne permet actuellement d’extraire ces données pour réaliser des analyses statisistiques. Pour répondre à ce besoin, Théodore Vanrengterghem a commencé à développer le package R {managHAL}. Le package permet l’extraction de données HAL et la création de bilans bibliographiques. En cours de développement, ce package ne permet pas actuellement la réalisation d’analyses bibliométriques.</p>
<p>Ainsi, durant mes 2 mois et 17 jours de stage au sein de l’unité mixte de recherche Mathématiques et Informatique Appliquées (MIA) - Paris Saclay, associée aux tutelles AgroParisTech, INRAE et Université Paris Saclay, j’ai travaillé sur rendre le package {managHAL} plus accessible et utilisable par d’autres unités de recherches que l’unité MIA - Paris Saclay. J’ai aussi travaillé sur la programmation et l’intégration d’outils d’analyse statistique de réseau au sein du package. Encadré par deux tuteurs, Julie Aubert et Pierre Barbillon, j’ai contribué à la mise en forme du package et à la création de fonctions spécifiques.</p>
<p>Pour comprendre les choix réalisés lors du développement du package, il est nécessaire de réaliser une introduction aux réseaux. Un réseau d’interaction est constitué de nœuds (les entités) et d’arêtes (les liens entre ces entités). Dans le cadre du package {managHAl}, j’utiliserai les réseaux pour modéliser un réseau de co-publications (ou co-auteurs). Les noeuds représenteront des auteurs, et les arêtes entre ces noeuds (auteurs) seront l’existence de publications scientifiques co-écrite par les deux noeuds. La taille d’un nœud représentera le nombre de publications écrites par cet auteur (noeud) et la largeur d’une arête pourra correspondre au nombre de publications co-ecrites par les deux noeuds (co-auteurs). Les réseaux ne sont cependant pas exclusifs à l’analyse de données bibliométriques. En effet, les réseaux sont utilisés comme représentation et comme objet d’analyse statistique dans de nombreux domaines. Par exemple, des réseaux de régulations de gènes sont réalisés à partir de données de co-expression. Il est possible de donner d’autres exemples comme les analyses de réseaux d’interactions entre des espèces (réseau trophique) réalisées en écologie (<a href="https://github.com/GrossSBM/sbm/blob/master/vignettes/SBM_fungus_tree_network.Rmd">analyse réalisée dans une vignette du package {sbm}</a>). Les utilisations des réseaux sont nombreuses. L’introduction aux réseaux et leurs analyses sera approfondie dans la section méthodes.</p>
<p>Ce package s’adresse donc à un public souhaitant réaliser des analyses bibliométriques approfondies à partir de HAL. Nous verrons cependant dans la section discussion qu’il est possible d’élargir les usages du package.</p>
</section>
</section>
<section id="méthodes" class="level2">
<h2 class="anchored" data-anchor-id="méthodes">Méthodes</h2>
<section id="modèle-de-graphe-aléatoire" class="level3">
<h3 class="anchored" data-anchor-id="modèle-de-graphe-aléatoire">Modèle de graphe aléatoire</h3>
<p>Cette partie est principalement basée sur la publication “Using Latent Block Models to Detect Structure in Ecological Networks” <a href="https://onlinelibrary.wiley.com/doi/10.1002/9781119902799.ch6"><span class="citation" data-cites="latent-block-models">Aubert et al. (<span>2022</span>)</span></a>.</p>
<p>Les réseaux se divisent en deux catégories principales (voir figures suivantes): les réseaux unipartites où tous les nœuds sont du même type et les réseaux bipartites où il y a deux types distincts de nœuds, et les liens ne se forment qu’entre des nœuds de types différents.(voir <a href="#reseau-unipart-bipart">exemple_reseau_unipartite_bipartite</a> pour le code de réalisation des réseaux d’exemple)</p>
<p><strong>Exemple des deux types de réseaux</strong></p>
<p><img src="figures/unipartite_graph.png" class="img-fluid" width="324" alt="Réseau Unipartite"> <img src="figures/bipartite.png" class="img-fluid" width="324" alt="Réseau Bipartite"></p>
<p>Les interactions dans un réseau peuvent être binaires ou pondérées. Un réseau peut être représenté par une matrice d’adjacence <span class="math inline">\(Y\)</span> où :</p>
<span class="math display">\[\begin{align*}
Y_{ij} \neq 0 &amp; \quad \text{si un lien existe entre les nœuds } i \text{ et } j, \\
Y_{ij} = 0 &amp; \quad \text{si aucun lien n'existe entre les nœuds } i \text{ et } j.
\end{align*}\]</span>
<p>Nous décrivons les noeuds d’un réseau comme : <span class="math inline">\(V = { 1,..,N }\)</span> , (<span class="math inline">\(N\)</span> correspond à la taille du réseau). Les arêtes peuvent être décrites comme <span class="math inline">\(E = \{ (i,j) | i,j \in V \}\)</span> représentant les paires de nœuds entre lesquels il existe une interaction. Chaque arête <span class="math inline">\((i,j)\)</span> indique une connexion entre les nœuds <span class="math inline">\(i\)</span> et <span class="math inline">\(j\)</span>.</p>
<p>Il existe plusieurs approches différentes pour analyser la structure d’un réseau. Dans ce mémoire, une seule approche sera considérée. Elle suppose l’existence de groupes fonctionnels partageant un même patron de connexion. Nous nous baserons par la suite sur une méthode possible pour cette approche: les modèles probabilistes génératifs.</p>
<p>Les Modèles en Bloc Stochastiques (aussi appelés SBM) sont des modèles probabilistes. Ils supposent que les nœuds d’un même réseau sont divisés en blocs (groupes, clusters) latents regroupant les entités ayant des modèles de connectivité similaires. Latents signifie qu’il n’y a pas d’a priori sur le type de structure recherchée. Ces modèles sont utiles pour détecter les communautés, les clusters au sein d’un réseau complexe. Pour réaliser un modèle en bloc stochastique, il est nécessaire de supposer que le réseau obtenu à partir de mes données est une réalisation de mon modèle.</p>
<p>Les noeuds sont partitionnés en <span class="math inline">\(K\)</span> groupes latents. On définit un vecteur <span class="math inline">\(Z\)</span> où <span class="math inline">\(Zi = k\)</span> , <span class="math inline">\(k\)</span> est le bloc auquel appartient le noeud <span class="math inline">\(i\)</span> . Dans le cas d’un réseau unipartite, on définit :</p>
<ul>
<li><p><span class="math inline">\(P(Zi = k) = \pi_k\)</span> , comme la probabilité d’appartenance au groupe <span class="math inline">\(k\)</span>.</p></li>
<li><p><span class="math inline">\(P(Y_{ij} = 1 | Z_i = k, Z_j = k') = \gamma_{kk'}\)</span> , comme la probabilité pour une paire de noeuds appartenant à un bloc <span class="math inline">\(k\)</span> et à un bloc <span class="math inline">\(k'\)</span> d’être en interaction (dans le cas binaire).</p></li>
</ul>
<p>Nous avons donc comme paramètres du modèle <span class="math inline">\(\theta = (\gamma, \pi)\)</span>. A partir du réseau connu, il est possible d’inférer les paramètres du modèle. Par nécessité d’écourter le rapport, une explication détaillée ne sera pas réalisée. Je vous conseille cependant d’aller voir la publication “Using Latent Block Models to Detect Structure in Ecological Networks” <span class="citation" data-cites="latent-block-models">Aubert et al. (<a href="#ref-latent-block-models" role="doc-biblioref">2022</a>)</span> où les explications à ce propos sont claires et précises.</p>
</section>
<section id="méthodes-informatiques" class="level3">
<h3 class="anchored" data-anchor-id="méthodes-informatiques">Méthodes informatiques</h3>
<p>Comme précisé dans l’introduction, l’intégralité des méthodes informatiques développées ont été réalisées sur RStudio en utilisant le langage R version 4.4.1 sous Windows 11 x64. Les packages utilisés sont les suivants :</p>
<p>Le package {dplyr} <span class="citation" data-cites="dplyr">(<a href="#ref-dplyr" role="doc-biblioref">Wickham et al. 2023</a>)</span> est utilisé pour la manipulation et la transformation des données grâce à une syntaxe claire et cohérente. Ce package facilite les opérations courantes telles que la sélection, le filtrage, le regroupement et le résumé des données. Le package {mailR} <span class="citation" data-cites="mailR">(<a href="#ref-mailR" role="doc-biblioref">Premraj 2021</a>)</span> est utilisé pour l’envoi d’emails avec des pièces jointes directement depuis R, ce qui est utile pour automatiser l’envoi de rapports. Le package {askpass} <span class="citation" data-cites="askpass">(<a href="#ref-askpass" role="doc-biblioref">Ooms 2023</a>)</span> est utilisé pour gérer les mots de passe de manière sécurisée. Le package {furrr} <span class="citation" data-cites="furrr">(<a href="#ref-furrr" role="doc-biblioref">Vaughan and Dancho 2022</a>)</span> est utilisé pour paralléliser les tâches en combinaison avec le package future <span class="citation" data-cites="future">(<a href="#ref-future" role="doc-biblioref">Bengtsson 2021</a>)</span>. Le package {future} <span class="citation" data-cites="future">(<a href="#ref-future" role="doc-biblioref">Bengtsson 2021</a>)</span> permet l’exécution de code en parallèle, ce qui réduit le temps de traitement des tâches lourdes. Le package {ggplot2} <span class="citation" data-cites="ggplot2">(<a href="#ref-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> est utilisé pour la création de visualisations graphiques sophistiquées. Le package {magrittr} <span class="citation" data-cites="magrittr">(<a href="#ref-magrittr" role="doc-biblioref">Bache and Wickham 2022</a>)</span> fournit des opérateurs pour améliorer la lisibilité du code, en particulier l’opérateur <code>%&gt;%</code> (pipe). Le package {purrr} <span class="citation" data-cites="purrr">(<a href="#ref-purrr" role="doc-biblioref">Wickham and Henry 2023</a>)</span> est utilisé pour les opérations fonctionnelles sur les listes et autres structures de données. Le package {quarto} <span class="citation" data-cites="quarto">(<a href="#ref-quarto" role="doc-biblioref">Allaire and Dervieux 2024</a>)</span> est utilisé pour la création de documents dynamiques et de rapports. Le package {readxl} <span class="citation" data-cites="readxl">(<a href="#ref-readxl" role="doc-biblioref">Wickham and Bryan 2023</a>)</span> permet la lecture de fichiers Excel. Le package {rvest} <span class="citation" data-cites="rvest">(<a href="#ref-rvest" role="doc-biblioref">Wickham 2024</a>)</span> est utilisé pour le web scraping, c’est-à-dire l’extraction de données à partir de pages web. Le package {SnowballC} <span class="citation" data-cites="SnowballC">(<a href="#ref-SnowballC" role="doc-biblioref">Bouchet-Valat 2023</a>)</span> est utilisé pour le traitement de la langue naturelle, en particulier pour la lemmatisation. Le package {stringr} <span class="citation" data-cites="stringr">(<a href="#ref-stringr" role="doc-biblioref">Wickham 2023</a>)</span> fournit des fonctions pour la manipulation des chaînes de caractères. Le package {tictoc} <span class="citation" data-cites="tictoc">(<a href="#ref-tictoc" role="doc-biblioref">Izrailev 2024</a>)</span> est utilisé pour mesurer le temps d’exécution des morceaux de code. Le package {tm} <span class="citation" data-cites="tm">(<a href="#ref-tm" role="doc-biblioref">Feinerer and Hornik 2024</a>)</span> est utilisé pour le text mining (extraction de connaissances à partir de textes). Le package {wordcloud} <span class="citation" data-cites="wordcloud">(<a href="#ref-wordcloud" role="doc-biblioref">Fellows 2018</a>)</span> est utilisé pour la création de nuages de mots. Le package {Visnetwork} <span class="citation" data-cites="chiquet2020">(<a href="#ref-chiquet2020" role="doc-biblioref">Chiquet, Donnet, and Barbillon 2020</a>)</span> est utilisé pour la visualisation de réseaux dynamiques. Le package {Sbm} <span class="citation" data-cites="sbm">(<a href="#ref-sbm" role="doc-biblioref">Chiquet, Donnet, and Barbillon 2024</a>)</span> est utilisé pour réaliser les analyses statistiques de réseaux.</p>
<p>Afin de pouvoir construire une requête HAL pour récupérer des données bibliographiques de publications d’auteurs, il est nécessaire de comprendre comment construire une requête. Pour construire une requête HAL, il faut au moins un paramètre <code>q</code> qui contient la requête de recherche. Ce paramètre doit spécifier le champ de recherche suivi de la valeur. Par exemple, pour rechercher le terme “test” : <code>http://api.archives-ouvertes.fr/search/?q=test&amp;wt=xml</code> . Si le champ n’est pas spécifié, la recherche s’effectue par défaut dans l’index texte. Pour rechercher dans un champ particulier, il faut utiliser <code>champ:terme</code> : <code>http://api.archives-ouvertes.fr/search/?q=title_t:japon&amp;wt=xml</code> . Pour échapper certains caractères spéciaux utilisés par Apache Solr, utilisez <code>\</code>. Par exemple, <code>(1+1):2</code> devient <code>\(1\+1\)\:2</code>. (voir <span class="citation" data-cites="api-hal"><span>“Documentation API-HAL”</span> (<a href="#ref-api-hal" role="doc-biblioref">n.d.</a>)</span>). Il est possible d’indiquer le format de la réponse (sous-entendant le format des données récupérées) via le paramètre <code>wt</code> . Pour finir il est possible de spécifier les champs à retourner dans la réponse via le paramètre <code>fl</code> et de faire un filtre des données via le paramètre <code>fq</code> (<a href="https://api.archives-ouvertes.fr/docs/search/?#q"><span class="citation" data-cites="api-hal"><span>“Documentation API-HAL”</span> (<span>n.d.</span>)</span></a>). Toutes les possibilités de l’API HAL n’ont pas été abordées dans ce court résumé. Il est pourtant compréhensible que l’API HAL est très diverse et permet une grande liberté à l’utilisateur pour l’extraction des données. De plus, il existe un nombre de champs considérables. Certains seront abordés par la suite dans la section résultats.</p>
<p>Pour finir, la totalité du stage s’est inscrit dans une dynamique de développement et d’intégration continue via la forge Gitlab d’INRAE. La forge GitLab, est un logiciel DevOps passant par le langage Git. Git est un système de contrôle, de versionning du code des développeurs gratuit et open source. Il permet à plusieurs développeurs de travailler sur un code sur un même dépôt et d’avancer ensemble par le biais de “merge”. “Merge” signifie que la personne modifiant un fichier contenant du code pousse en ligne sur le dépôt partagé , les modifications réalisées.</p>
</section>
</section>
<section id="résultats" class="level2">
<h2 class="anchored" data-anchor-id="résultats">Résultats</h2>
<p>Cette section présente les résultats obtenus au cours de mon stage. Elle est divisée en deux parties principales: Les modifications faites au package {managHAL} d’origine dans l’objectif de le rendre plus générique et plus accessible, puis l’ajout de fonctionnalités au package {managHAL}. Par choix, seulement certaines fonctions et scripts R du package sont abordés. L’exécution de ces derniers est réalisée par le biais d’un exemple. Cet exemple est basé sur des données de l’UMR MIA-Paris-Saclay. Chaque fonction est expliquée en détail, suivie des raisons justifiant son développement. Il est important de noter que mon stage se terminant le 26 juillet, Le package est encore en développement. Certaines fonctionnalités sont encore en travail. Les fonctions présentées fonctionnent dans le cadre de l’exemple. Si vous souhaitez exécuter les scripts fournis dans le mémoire, il est nécessaire d’avoir accès au package {managHAL}. Dans cette section, les noms de <em><code>fonctions</code></em> seront en italique et les noms des <strong>scripts R</strong> contenant les fonctions seront en gras.</p>
<section id="accessibilité-et-généricité-de-managhal" class="level3">
<h3 class="anchored" data-anchor-id="accessibilité-et-généricité-de-managhal">Accessibilité et généricité de {managHAL}</h3>
<p>Lors de mon stage, j’ai d’abord décidé de rendre le package plus accessible et générique. Pour ce faire, il m’était nécessaire de réorganiser et modifier certaines fonctions déjà présentes codées par Théodore Vanrengterghem.</p>
<section id="modifications-de-la-fonction-load_mia_table" class="level4">
<h4 class="anchored" data-anchor-id="modifications-de-la-fonction-load_mia_table">Modifications de la fonction <em><code>load_mia_table</code></em></h4>
<p>J’ai commencé par modifier dans le fichier <strong>mia_table.R</strong> la fonction <em><code>load_mia_table</code></em>. A l’origine, cette fonction permettait le chargement d’un csv en ligne fourni par les Ressources Humaines depuis un serveur. Le fichier contient des informations telles que le nom, le prénom, l’idhal, l’équipe, etc, des personnes appartenant au labo. Cette fonction n’était pas générique. Ainsi, il était nécessaire de la modifier. J’ai fait le choix de renommer le fichier <strong>load_table.R</strong>. J’ai remplacé la fonction <em><code>load_mia_table</code></em> par trois fonctions <em><code>load_team_table_csv</code></em>, <em><code>load_team_table_url</code></em>, et <em><code>load_team_table</code></em>. J’ai aussi modifié la majorité des fonctions déjà présentes dans le package faisant appel à <em><code>load_mia_table</code></em>. Les paramètres en entrée des trois fonctions sont les même que la fonction <em><code>load_mia_table</code></em> d’origine avec l’ajout d’un paramètre permettant à l’utilisateur de rentrer l’adresse du fichier. J’ai ensuite créé une documentation via le package {roxygène2} conforme aux critères requis pour un package mis en ligne (veuillez vous référez à l’annexe : <a href="#doc-Roxygen2">Exemple d’une documentation classique avec Roxygen2</a> ) pour chacune des trois fonctions.</p>
<p><em><code>load_team_table_url</code></em> permet de charger un csv dans RStudio depuis un fichier en ligne. J’ai décidé pour <em><code>load_team_table_url</code></em> de garder en majeur partie le code d’origine et de simplement le réadapter par soucis de temps. J’y ai ajouté des conditions de présence de colonnes obligatoires afin d’obliger l’utilisateur à fournir des colonnes sous un format spécifique. (Pour voir le corps de la fonction, veuillez vous référer à l’annexe : <a href="#load-team-table-url">load_team_table_url</a>)</p>
<p><em><code>load_team_table_csv</code></em> est basée sur la construction de <em><code>load_team_table_url</code></em>. Je l’ai adapté pour pouvoir charger depuis un fichier local de la machine de l’utilisateur en utilisant <em>read.csv</em>. De même que dans <em><code>load_team_table_url</code></em>, j’y ai ajouté des conditions de présence de colonnes obligatoires afin d’obliger l’utilisateur à fournir des colonnes sous un format spécifique. (Pour voir le corps de la fonction, veuillez vous référer à l’annexe : <a href="#load-team-table-csv">load_team_table_csv</a>)</p>
<p>Enfin, <em><code>load_team_table</code></em> appelle l’une des deux fonctions en fonction du type d’adresse fourni : URL ou chemin de fichier local. Le type de l’adresse est déterminé en utilisant <em><code>grepl</code></em>, qui utilise une expression régulière. (Pour voir le corps de la fonction, veuillez vous référer à l’annexe : <a href="#load-team-table">load_team_table</a>)</p>
</section>
<section id="résultat-de-lapplication-de-load_team_table" class="level4">
<h4 class="anchored" data-anchor-id="résultat-de-lapplication-de-load_team_table">Résultat de l’Application de <em>load_team_table</em></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_RH_csv_Example <span class="ot">&lt;-</span> <span class="fu">load_team_table</span>(<span class="at">filter_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_cols =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>), <span class="at">filepath_or_url =</span> <span class="st">"./data/Data_RH_Example.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># afin de ne garder que les lignes avec un idhal</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># correct</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data_RH_csv_Example <span class="ot">&lt;-</span> data_RH_csv_Example[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(data_RH_csv_Example<span class="sc">$</span>idhal)),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_RH_csv_Example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  civilite       nom prenom statut  rattachement debut_contrat fin_contrat
1       M. ADJAKOSSA   Éric    CEC AgroParisTech                          
6      Mme    AUBERT  Julie     IR         INRAE                          
8       M. BARBILLON Pierre     PR AgroParisTech                          
  financement  equipe  unite               orcid  idhal
1             SOLsTIS MIA PS 0000-0002-5280-0347 749339
6             SOLsTIS MIA PS 0000-0001-5203-5748  15356
8             SOLsTIS MIA PS 0000-0002-7766-7693  16750
                       adresse_mail
1   eric-houngla.adjakossa@inrae.fr
6             julie.aubert@inrae.fr
8 Pierre.Barbillon@Agroparistech.fr</code></pre>
</div>
</div>
<p>Lors de l’application de la fonction <em><code>load_team_table</code></em> ci-dessus en utilisant le jeu de données test Data_RH_Example, on observe le chargement d’un csv contenant les colonnes d’origine du csv fournies en entrée. Les valeurs manquantes ou mal renseignées des idhals numériques ont été remplacées par des NAs. Les dates présentes dans les colonnes de dates spécifiées par l’utilisateur ont été nettoyées et ont le bon format.</p>
</section>
<section id="modifications-des-fonctions-régissant-la-requête-hal" class="level4">
<h4 class="anchored" data-anchor-id="modifications-des-fonctions-régissant-la-requête-hal">Modifications des fonctions régissant la requête HAL</h4>
<p>Dans le package {managHAL} originel, il y avait deux fichiers contenant les fonctions nécessaires à la construction d’une requête HAL. Ces deux fichiers se nomment <strong>HAL_reports.R</strong> et <strong>HAL_queries.R</strong>. La fonction principale de construction d’une requête HAL est <em><code>HAL_query</code></em>. Elle prend en entrée différents paramètres et construit une url correspondant à une requête HAL. Ces différents paramètres définissent les différents champs, filtres, sorties demandées de la requête. Les champs de sortie ne convenant pas et manquait d’information pour la construction d’un réseau. Ainsi, après réflexion et discussion avec mes tuteurs Julie Aubert et Pierre Barbillon, j’ai modifié les différents champs de sorties afin d’obtenir les données nécessaires et essentielles à la construction d’un réseau. Par exemple, le champ ‘authFullNamePersonIDIDHal_fs’ permet de spécifier à HAL_query de récupérer les noms et les identifiants HAL numériques des autheurs d’une même publication. Le paramètre add_output ajouté par Théodore Vanrengterghem dans la fonction d’origine permet à l’utilisateur de rentrer des champs de sortie spécifiques en plus. Ce paramètre a été beaucoup utilisé au cours de ce stage dans la création de fonction permettant la création de réseau.</p>
<p>La fonction d’origine ne créer pas d’url d’une page permettant de récupérer les publications autres qu’à partir d’identifiants numériques d’auteurs, j’ai modifié les paramètres d’entrée et le corps de la fonction afin que l’utilisateur puissent spécifier si les identifiants fournis sont des identifiants de structures ou des identifiants de personnes. La nouvelle fonction HAL_query crée un url qui peut récupérer au choix de l’utilisateur une liste de publications associés à une structure via son identifiant ou une liste de publications associés à un identifiant numérique. (Pour voir le corps de la fonction, veuillez vous référer à l’annexe : <a href="#HAL-query">HAL_query</a>)</p>
<p>Plusieurs fonctions présentes avant mes modifications faisait appel à HAL_query. Ces dernières comme HAL_extract_csv ont donc été modifiées afin de correspondre à la nouvelle version de HAL_query. De même Les fonctions auquelles fait appel HAL_query ont elles aussi été modifiées pour correspondre à HAL_query. HAL_extract_csv est une fonction récupèrant l’url via HAL_query. Pour montrer les résultats obtenus avec HAL_query, des exemples ci-dessous seront réalisés avec HAL_extract_csv pour une liste d’identifiants numérique d’auteurs et pour un identifiant d’une unité/laboratoire. Il sera ajouté des sorties via le paramètres add_outputs :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>date_min <span class="ot">=</span> <span class="st">"01/01/2022"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>date_max <span class="ot">=</span> <span class="st">"01/01/2023"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Publications à partir d'un id de laboratoire.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>HAL_publis_Labo <span class="ot">&lt;-</span> managHAL<span class="sc">::</span><span class="fu">HAL_extract_csv</span>(<span class="at">id =</span> <span class="dv">1002311</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    date_min, date_max, <span class="at">type_id =</span> <span class="st">"struct_id"</span>, <span class="at">add_output =</span> <span class="fu">c</span>(<span class="st">"structAcronym_s"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"structId_i"</span>, <span class="st">"structHasAlphaAuthIdHalPersonid_fs"</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>HAL_publis_Labo[<span class="dv">1</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    docid      halId_s version_i docType_s
1 4440523 hal-04440523         1      COMM
                                                                                                                                                                                                                                                                                                                                                                         citationFull_s
1 Isabelle Lebert, Maxime Rates, Julien Pradel, Laure Mathews-Martin, Aurore Latour, et al.. Evaluation du risque d’exposition aux tiques et aux agents de la maladie de Lyme dans les espaces verts de la région lyonnaise : résultats de la surveillance 2019-2023. Colloque final de restitution du projet Biodiversa-Bioroddi, Nov 2023, Lyon (Sciences Po), France. ⟨hal-04440523⟩
                                                                                      citationRef_s
1 Colloque final de restitution du projet Biodiversa-Bioroddi, Nov 2023, Lyon (Sciences Po), France
  publicationDate_tdate
1  2023-01-01T00:00:00Z
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    authFullNamePersonIDIDHal_fs
1 Isabelle Lebert_FacetSep_184610_FacetSep_isabelle-lebert,Maxime Rates_FacetSep_749136_FacetSep_maxime-rates,Julien Pradel_FacetSep_1284695_FacetSep_,Laure Mathews-Martin_FacetSep_1310514_FacetSep_,Aurore Latour_FacetSep_0_FacetSep_,Maximilien Barbier_FacetSep_0_FacetSep_,Gwenaël Vourc’h_FacetSep_736823_FacetSep_gwenael-vourch,Valerie Poux_FacetSep_744163_FacetSep_valerie-poux,Séverine Barry_FacetSep_744034_FacetSep_severine-barry,Sébastien Masseglia_FacetSep_744051_FacetSep_sebastien-masseglia,Severine Bord_FacetSep_180861_FacetSep_severine-bord,Karine Chalvet-Monfray_FacetSep_743281_FacetSep_karine-chalvet-monfray,Diana Sepúlveda_FacetSep_0_FacetSep_,Luc Chabanne_FacetSep_754272_FacetSep_luc-chabanne,Nathalie Charbonnel_FacetSep_736426_FacetSep_nathalie-charbonnel,Magalie René-Martellet_FacetSep_744046_FacetSep_magalie-rene-martellet
                                                                                               structAcronym_s
1 UMR EPIA,VAS,INRAE,UMR CBGP,Cirad,IRD [France-Sud],INRAE,Institut Agro,UM,LRFSN,ANSES,MIA Paris-Saclay,INRAE
                                                                                                                            structId_i
1 1002382,301767,577435,1100832,11574,451860,577435,1096330,1042499,1100589,561191,301715,1002311,148117,419361,577435,1056557,1031275
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             structHasAlphaAuthIdHalPersonid_fs
1 L_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_isabelle-lebert_FacetSep_184610_FacetSep_Lebert Isabelle,L_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_isabelle-lebert_FacetSep_184610_FacetSep_Lebert Isabelle,L_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_isabelle-lebert_FacetSep_184610_FacetSep_Lebert Isabelle,R_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_maxime-rates_FacetSep_749136_FacetSep_Rates Maxime,R_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_maxime-rates_FacetSep_749136_FacetSep_Rates Maxime,R_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_maxime-rates_FacetSep_749136_FacetSep_Rates Maxime,P_AlphaSep_1100832_FacetSep_Centre de Biologie pour la Gestion des Populations_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_11574_FacetSep_Centre de Coopération Internationale en Recherche Agronomique pour le Développement_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_451860_FacetSep_Institut de Recherche pour le Développement_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_1096330_FacetSep_Institut Agro Montpellier_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_1042499_FacetSep_Institut national d'enseignement supérieur pour l'agriculture\\, l'alimentation et l'environnement_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,P_AlphaSep_1100589_FacetSep_Université de Montpellier_JoinSep__FacetSep_1284695_FacetSep_Pradel Julien,M_AlphaSep_561191_FacetSep_Laboratoire de la rage et de la faune sauvage de Nancy_JoinSep__FacetSep_1310514_FacetSep_Mathews-Martin Laure,M_AlphaSep_301715_FacetSep_Agence nationale de sécurité sanitaire de l'alimentation\\, de l'environnement et du travail_JoinSep__FacetSep_1310514_FacetSep_Mathews-Martin Laure,L_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep__FacetSep_0_FacetSep_Latour Aurore,L_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep__FacetSep_0_FacetSep_Latour Aurore,L_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep__FacetSep_0_FacetSep_Latour Aurore,B_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep__FacetSep_0_FacetSep_Barbier Maximilien,B_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep__FacetSep_0_FacetSep_Barbier Maximilien,B_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep__FacetSep_0_FacetSep_Barbier Maximilien,V_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_gwenael-vourch_FacetSep_736823_FacetSep_Vourc’h Gwenaël,V_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_gwenael-vourch_FacetSep_736823_FacetSep_Vourc’h Gwenaël,V_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_gwenael-vourch_FacetSep_736823_FacetSep_Vourc’h Gwenaël,P_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_valerie-poux_FacetSep_744163_FacetSep_Poux Valerie,P_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_valerie-poux_FacetSep_744163_FacetSep_Poux Valerie,P_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_valerie-poux_FacetSep_744163_FacetSep_Poux Valerie,B_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_severine-barry_FacetSep_744034_FacetSep_Barry Séverine,B_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_severine-barry_FacetSep_744034_FacetSep_Barry Séverine,B_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_severine-barry_FacetSep_744034_FacetSep_Barry Séverine,M_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_sebastien-masseglia_FacetSep_744051_FacetSep_Masseglia Sébastien,M_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_sebastien-masseglia_FacetSep_744051_FacetSep_Masseglia Sébastien,M_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_sebastien-masseglia_FacetSep_744051_FacetSep_Masseglia Sébastien,B_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_1002311_FacetSep_Mathématiques et Informatique Appliquées_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_148117_FacetSep_AgroParisTech_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_419361_FacetSep_Université Paris-Saclay_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,B_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_severine-bord_FacetSep_180861_FacetSep_Bord Severine,C_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_karine-chalvet-monfray_FacetSep_743281_FacetSep_Chalvet-Monfray Karine,C_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_karine-chalvet-monfray_FacetSep_743281_FacetSep_Chalvet-Monfray Karine,C_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_karine-chalvet-monfray_FacetSep_743281_FacetSep_Chalvet-Monfray Karine,S_AlphaSep_1056557_FacetSep_Direction ‑ Écologie Urbaine de la Ville de Lyon_JoinSep__FacetSep_0_FacetSep_Sepúlveda Diana,S_AlphaSep_1031275_FacetSep_Partenaires INRAE_JoinSep__FacetSep_0_FacetSep_Sepúlveda Diana,C_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_luc-chabanne_FacetSep_754272_FacetSep_Chabanne Luc,C_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_luc-chabanne_FacetSep_754272_FacetSep_Chabanne Luc,C_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_luc-chabanne_FacetSep_754272_FacetSep_Chabanne Luc,C_AlphaSep_1100832_FacetSep_Centre de Biologie pour la Gestion des Populations_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_11574_FacetSep_Centre de Coopération Internationale en Recherche Agronomique pour le Développement_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_451860_FacetSep_Institut de Recherche pour le Développement_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_1096330_FacetSep_Institut Agro Montpellier_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_1042499_FacetSep_Institut national d'enseignement supérieur pour l'agriculture\\, l'alimentation et l'environnement_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,C_AlphaSep_1100589_FacetSep_Université de Montpellier_JoinSep_nathalie-charbonnel_FacetSep_736426_FacetSep_Charbonnel Nathalie,R_AlphaSep_1002382_FacetSep_Unité Mixte de Recherche d'Épidémiologie des maladies Animales et zoonotiques_JoinSep_magalie-rene-martellet_FacetSep_744046_FacetSep_René-Martellet Magalie,R_AlphaSep_301767_FacetSep_VetAgro Sup - Institut national d'enseignement supérieur et de recherche en alimentation\\, santé animale\\, sciences agronomiques et de l'environnement_JoinSep_magalie-rene-martellet_FacetSep_744046_FacetSep_René-Martellet Magalie,R_AlphaSep_577435_FacetSep_Institut National de Recherche pour l’Agriculture\\, l’Alimentation et l’Environnement_JoinSep_magalie-rene-martellet_FacetSep_744046_FacetSep_René-Martellet Magalie</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Publications à partir d'ids auteurs</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>HAL_publis_auteurs <span class="ot">&lt;-</span> managHAL<span class="sc">::</span><span class="fu">HAL_extract_csv</span>(<span class="at">id =</span> data_RH_csv_Example[,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">12</span>], date_min, date_max, <span class="at">type_id =</span> <span class="st">"person_id"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>HAL_publis_auteurs[<span class="dv">1</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    docid      halId_s version_i docType_s
1 4190551 hal-04190551         1       ART
                                                                                                                                                                                                                                                                                citationFull_s
1 Emmanuelle Blanc, Jérôme Enjalbert, Timothée Flutre, Pierre Barbillon. Efficient Bayesian automatic calibration of a functional-structural wheat model using an adaptive design and a metamodeling approach. Journal of Experimental Botany, In press, ⟨10.1093/jxb/erad339⟩. ⟨hal-04190551⟩
                                                    citationRef_s
1 Journal of Experimental Botany, In press, ⟨10.1093/jxb/erad339⟩
  publicationDate_tdate
1  2023-01-01T00:00:00Z
                                                                                                                                                                                         authFullNamePersonIDIDHal_fs
1 Emmanuelle Blanc_FacetSep_0_FacetSep_,Jérôme Enjalbert_FacetSep_1169771_FacetSep_jerome-enjalbert,Timothée Flutre_FacetSep_11756_FacetSep_timothee-flutre,Pierre Barbillon_FacetSep_16750_FacetSep_pierre-barbillon</code></pre>
</div>
</div>
</section>
</section>
<section id="ajout-de-fonctionnalité-à-managhal" class="level3">
<h3 class="anchored" data-anchor-id="ajout-de-fonctionnalité-à-managhal">Ajout de fonctionnalité à {managHAL}</h3>
<section id="création-dun-réseau-de-co-auteurs-et-visualisation-avec-visnetwork" class="level4">
<h4 class="anchored" data-anchor-id="création-dun-réseau-de-co-auteurs-et-visualisation-avec-visnetwork">Création d’un réseau de co-auteurs et visualisation avec visNetwork</h4>
<p>Afin d’obtenir les informations sous-jacentes des données bibliographiques, j’ai commencé à travailler à la création d’un réseau de co-auteur. Pour l’instant, la fonctionnalité n’existe qu’au format de script R sur un document quarto. Au cours des semaines restantes, l’objectif est de continuer à travailler dessus et créer des fonctions simples et claires permettant à l’utilisateur de créer son propre réseau à partir de ses données. Le script de création de fonction est inspiré d’un script fournie au préalable par ma tutrice Julie Aubert. Des modifications et des ajouts ont été apportés pour améliorer l’extraction, le nettoyage, la construction, et la visualisation des données. Suite à mes modifications et mes ajouts, le script se divise en plusieurs parties ((Pour voir le script R, veuillez vous référer à l’annexe : <a href="#reseau-co-auteur">Script_R_reseau_co-auteur</a>) :</p>
<p>La première partie correspond à l’extraction et au nettoyage des données. Les données brutes ont été organisées et nettoyées pour être adaptées à la construction du réseau. Les années de publication ont été extraites et les identifiants des auteurs ont été nettoyé. Les auteurs ont été associés aux structures pertinentes, et les incohérences de noms ou d’identifiants HAL ont été corrigées. Des identifiants fictifs ont été créés pour les auteurs sans identifiant.</p>
<p>La deuxième partie concerne la construction et la visualisation du graphe. À partir des données nettoyées, des matrices de contingence ont été créées. Ces matrices ont été converties en listes de nœuds (auteurs) et en listes d’arêtes (collaborations). Les nœuds ont été colorés et groupés en fonction des années de publication, et des légendes ont été ajoutées pour faciliter la compréhension du graphe. Des descriptions supplémentaires ont été intégrées pour enrichir les légendes, et la visualisation finale du réseau a été réalisée via visnetwork.</p>
<p>Il est possible de voir via l’exemple suivant (obtenu avec le code de l’annexe : <a href="#reseau-co-auteur">Script_R_reseau_co-auteur</a>) qu’un réseau de co-auteurs permet une visualisation claire des collaborations et des périodes d’activité des différents auteurs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Full_Network_Co-authors_Example_managHAL.jpeg" class="img-fluid figure-img" width="500"></p>
<figcaption>Réseau de co-auteurs</figcaption>
</figure>
</div>
<p>A travers cet exemple, les limitations de la création de réseau sur les données récupérées via un identifiant de laboratoire transparaissent. De fait, on voit l’apparition de cercle de co-auteurs très denses. Ces cercles correspondent généralement à une unique publication contenant de nombreux auteurs.</p>
</section>
<section id="modélisation-en-blocs-stochastiques" class="level4">
<h4 class="anchored" data-anchor-id="modélisation-en-blocs-stochastiques">Modélisation en blocs stochastiques</h4>
<p>J’ai tout de même réalisé un modèle en bloc stochastique sur ce réseau. (voir le code du script en annexe :<a href="#Script-R-SBM-Full-Network">Script_R_SBM</a>). Pour cela j’ai créé une matrice d’adjacence vide et je l’ai remplie avec les connexions pondérées des nœuds, puis nettoyée pour la lisibilité et visualisée avec plotMyMatrix. Ensuite, un modèle SBM est estimé à partir de cette matrice, les nœuds sont classés en groupes colorés. Enfin, le réseau est visualisé avec visNetwork, incluant des options pour une meilleure compréhension et esthétique.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Full_Network_Co-authors_SBM_Example_managHAL.png" class="img-fluid figure-img" width="500"></p>
<figcaption>Application des couleurs d’appartenance des noeuds via le modèle</figcaption>
</figure>
</div>
<p>L’apparition de groupes de noeuds avec des interactions similaires colorés était attendue. Or dans l’exemple suivant, des groupes d’une même couleur n’apparaissent pas et les noeuds avec des profils de connexion similaire ne semblent pas être placé dans un même groupe. C’est pourquoi, j’ai décidé sur conseil de mes tuteurs de réaliser les mêmes manipulations sur un sous-groupe de données ne contenant que celles des auteurs affiliés à une seule structure. Nous avons noté la présence d’un biais car certains auteurs n’étant plus affiliés à la structure ont toujours le tag de la structure dans leur compte HAL. Ils apparaissent affiliés à la structure sans l’être réellement. (voir le code du script en annexe :<a href="#Script-R-SBM-Partial-Network">Script_R_Sous-groupe</a>)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Partial_Network_Co-author_SBM.png" class="img-fluid figure-img" width="500"></p>
<figcaption>Application des couleurs d’appartenance des noeuds via le nouveau modèle sur le réseau de co-auteurs de l’UMR MIA - Paris Saclay</figcaption>
</figure>
</div>
<p>De plus, le sbm obtenu n’étant toujours pas satisfaisant, une autre proposition a été mise en avant, se contenter de réaliser un sbm sur les composantes connexes du réseau. Cela n’a pas été encore réalisé et fait partie des possibles améliorations future du package {managHAL}.</p>
</section>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>Au cours de cette partie, plusieurs sujets seront abordés. Les limites actuelles du package {managHAL} et les possibles améliorations seront discutées. Les résultats obtenus seront replacés dans un contexte scientifique plus large. Enfin, les utilisations potentielles du package {managHAL} seront examinées.</p>
<p>Premièrement, il est important de parler des limites rencontrées au cours de ce projet. Un des défis a été l’intégration de l’API HAL. Malgré mes efforts, l’API HAL s’est révélée complexe et souvent peu intuitive. En effet, il existe des centaines de champs pour récupérer des données sur l’API HAL. Cela m’a freiné dans la compréhension de l’API et dans la modification des fonctions utilisant cette dernière. Les erreurs rencontrées étaient souvent dues à une mauvaise récupération des données ou à une confusion de ma part par rapport au formatage de ces dernières. J’ai donc eu besoin de nombreuses heures de recherches, de débogage et de tests pour obtenir les résultats attendus.</p>
<p>De plus, bien que le code développé ait montré une certaine efficacité en terme de temps de calcul, il reste des marges d’amélioration. Par exemple, certaines parties du code pourraient être optimisées pour améliorer les performances des fonctions et réduire le temps de traitement. Remplacer les boucles <code>for</code> par <code>apply</code>, qui est optimisée et plus rapide, pourrait être une solution. De même, pour la création de réseaux et l’utilisation de modélisation en bloc stochastique, il est encore possible d’améliorer le temps de traitement en recherchant et modifiant les options des fonctions utilisées ou en créant des sous-groupes comme présenté dans les résultats.</p>
<p>Une des ambitions de ce projet est de s’inscrire dans une dynamique de science ouverte. Le mémoire écrit et produit avec Quarto illustre cette démarche en rendant le mémoire et les résultats accessibles et reproductibles sur un répertoire GitHub (<a href="https://github.com/MartinAmiens/Internship-Report-Quarto.git">repositoryMémoire</a>). S’il était possible de lier les résultats obtenus à des résultats provenant d’autres bases de données telles que WebOfScience, la valeur scientifique des recherches effectuées via le package {managHAL} pourrait être considérablement enrichie. Avant la fin du stage, je prévois de travailler sur la documentation et les tests. L’objectif est d’améliorer la documentation du code pour faciliter son utilisation par d’autres développeurs, de documenter les fonctions pour en faciliter l’utilisation par d’autres personnes, et d’ajouter des tests pour garantir la bonne fonctionnalité du package. Je prévois aussi d’ajouter de nouvelles fonctionnalités. Dans un premier temps, je souhaite coder les fonctions et sous-fonctions permettant de construire un réseau de co-auteurs plutôt que d’avoir un simple script R sur un document quarto. Puis, je souhaite coder les fonctions permettant d’obtenir un modèle en bloc stochastique via le package ‘sbm’. Cela permettrait de simplifier l’utilisation du package et de le rendre plus générique. Dans un second temps, je prévois de nettoyer le package entièrement et de vérifier qu’il est bien aux normes pour qu’il puisse être publié à la fin de mon stage.</p>
<p>En ce qui concerne les utilisations potentielles du package développé, en premier lieu, {managHAL} est destiné à être utilisé par les personnes voulant réaliser des rapports sur les dynamiques sous-jacentes des publications au sein d’un laboratoire. Ensuite, il est possible qu’il soit utilisé par les personnes souhaitant faire un rapport bibliographique ou réaliser des vérifications quant aux erreurs d’ajout de publications des chercheurs sur HAL. Enfin, il y a des parallèles intéressants à explorer avec d’autres domaines scientifiques, comme la biologie. Les méthodes utilisées pour l’analyse de réseaux sont génériques et utilisables sur d’autres types de réseaux, et les fonctions de visualisation de réseaux par exemple peuvent être utilisées pour d’autres utilisations telle la visualisation d’un réseau de régulation de gène.</p>
<p>En conclusion, ce stage a permis de réaliser des avancées significatives dans le développement de l’outil qu’est le package {managHAL} malgré les défis rencontrés. Les prochaines étapes incluront des optimisations et des développements supplémentaires pour renforcer l’impact et la portée du travail réalisé, tout en restant alignées avec les principes de la science ouverte. Cette démarche, combinée à une réflexion continue sur les objectifs et les résultats, permettra non seulement d’améliorer la qualité du travail actuel, mais aussi de poser les bases pour l’entretien du package par les futurs développeurs.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="annexes" class="level2">
<h2 class="anchored" data-anchor-id="annexes">Annexes</h2>
<section id="load-team-table-url" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="load-team-table-url">load_team_table_url</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>load_team_table_url <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter_id =</span> <span class="cn">TRUE</span>, date_cols,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    url) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    idhal <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    tmp_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tempfile</span>(), <span class="st">".xlsx"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(<span class="at">url =</span> url, <span class="at">destfile =</span> tmp_file, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    nbcol <span class="ot">&lt;-</span> <span class="fu">ncol</span>(readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(tmp_file, <span class="at">sheet =</span> <span class="st">"Membres"</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    col_types <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"text"</span>, nbcol)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    col_types[date_cols] <span class="ot">&lt;-</span> <span class="st">"date"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    table <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(tmp_file, <span class="at">sheet =</span> <span class="st">"Membres"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> col_types) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename_with</span>(clean_names) <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(<span class="cf">function</span>(x) {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"POSIXt"</span> <span class="sc">%in%</span> <span class="fu">class</span>(x)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        }, <span class="sc">~</span><span class="fu">format</span>(.x, <span class="st">"%d/%m/%Y"</span>))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (filter_id) {</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        table <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(table <span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">as.numeric</span>(idhal))) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">idhal =</span> <span class="fu">as.numeric</span>(idhal)))</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test if there is a column named 'id'</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Possibility to add mandatory columns in the</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># future Just add 'OR'</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"idhal"</span> <span class="sc">%in%</span> <span class="fu">names</span>(table)) <span class="sc">|</span> <span class="sc">!</span>(<span class="st">"nom"</span> <span class="sc">%in%</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(table)) <span class="sc">|</span> <span class="sc">!</span>(<span class="st">"prenom"</span> <span class="sc">%in%</span> <span class="fu">names</span>(table))) {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"one of the following columns are missing : 'idhal' ; 'nom' ; 'prenom' "</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(table)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction permet le chargement d’un fichier csv depuis un url. Elle prend en entrée une adresse url, un booléen déterminant le nettoyage ou non des valeurs idHALs, et un vecteur contenant le numéro des colonnes de dates. Elle donne en sortie le chargement d’un fichier csv.</p>
</section>
<section id="load-team-table-csv" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="load-team-table-csv">load_team_table_csv</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>load_team_table_csv <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter_id =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                                date_cols,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                                filepath){</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  idhal <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read the csv table  </span><span class="al">TODO</span><span class="co"> : Add message error to guide user</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if sep is different than ";" </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and if header = false</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  nbcol <span class="ot">&lt;-</span> <span class="fu">ncol</span>(<span class="fu">read.csv</span>(filepath, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define column types (dates or text if not dates)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  col_types <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"character"</span>, nbcol)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  col_types[date_cols] <span class="ot">&lt;-</span> <span class="st">'character'</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  table <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(filepath,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">encoding =</span> <span class="st">"UTF-8"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colClasses =</span> col_types</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename_with</span>(  <span class="co"># clean the columns names </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      clean_names</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(<span class="cf">function</span>(x) {  <span class="co"># Convert specified column to dates</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"POSIXt"</span> <span class="sc">%in%</span> <span class="fu">class</span>(x)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    }, <span class="sc">~</span> <span class="fu">format</span>(.x, <span class="st">"%d/%m/%Y"</span>))</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out rows without IDHAL</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (filter_id) {</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    idhal <span class="ot">&lt;-</span> table<span class="sc">$</span>idhal</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    table <span class="ot">&lt;-</span> table[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(idhal)),]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    table<span class="sc">$</span>idhal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(idhal)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    table<span class="sc">$</span>idhal[table<span class="sc">$</span>idhal <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    table <span class="ot">&lt;-</span> table[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(idhal)),]</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test if there is a column named "id"</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Possibility to add mandatory columns in the future</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just add "OR"</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="sc">!</span>(<span class="st">"idhal"</span> <span class="sc">%in%</span> <span class="fu">names</span>(table)) <span class="sc">|</span> <span class="sc">!</span>(<span class="st">"nom"</span> <span class="sc">%in%</span> <span class="fu">names</span>(table)) <span class="sc">|</span> <span class="sc">!</span>(<span class="st">"prenom"</span> <span class="sc">%in%</span> <span class="fu">names</span>(table)) ) { <span class="fu">stop</span>(<span class="st">"one of the following columns are missing : 'idhal' ; 'nom' ; 'prenom' "</span>) }</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction permet le chargement d’un fichier csv depuis une adresse locale de la machine de l’utilisateur. Elle prend en entrée une adresse locale d’un fichier csv, un booléen déterminant le nettoyage ou non des valeurs idHALs, et un vecteur contenant le numéro des colonnes de dates. Elle donne en sortie le chargement d’un fichier csv.</p>
</section>
<section id="load-team-table" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="load-team-table">load_team_table</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>load_team_table <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter_id =</span> <span class="cn">TRUE</span>, <span class="at">date_cols =</span> <span class="fu">c</span>(<span class="dv">7</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>), filepath_or_url) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the parameter is a URL</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"^https?://"</span>, filepath_or_url)) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Call the load_team_table_url function</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># with the URL</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">load_team_table_url</span>(<span class="at">filter_id =</span> filter_id,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">date_cols =</span> date_cols, <span class="at">url =</span> filepath_or_url))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Otherwise, it's a local file path; call</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the load_team_table_csv function with</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the local file path</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">load_team_table_csv</span>(<span class="at">filter_id =</span> filter_id,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">date_cols =</span> date_cols, <span class="at">filepath =</span> filepath_or_url))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction permet le chargement d’un fichier csv depuis une adresse locale de la machine de l’utilisateur ou depuis une adresse url. Elle prend en entrée une adresse locale d’un fichier csv ou une URL, un booléen déterminant le nettoyage ou non des valeurs idHALs, et un vecteur contenant le numéro des colonnes de dates. Elle donne en sortie le chargement d’un fichier csv.</p>
</section>
<section id="doc-Roxygen2" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="doc-Roxygen2">Exemple d’une documentation classique avec Roxygen2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' load_team_table_csv</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function loads a team table from a CSV file, allowing optional filtering </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' based on the presence of an IDHAL an specifying which columns contain dates.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param filter_id erase person without IDHAL (default = TRUE)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param date_cols positions of dates columns, others will be read as text</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param filepath the file path of the CSV table</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom magrittr %&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom utils read.csv</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a data.frame containing information from team</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' \dontrun{</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' load_team_table_csv(filter_id = TRUE,</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#'                     date_cols = c(7,8),</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#'                     'C:/users/.../.../Classeur.csv')</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce script permet la création d’une documentation de fonction classique via la commande : <code>devtools::document()</code>. Elle est au format utilisé par {roxygen2}.</p>
</section>
<section id="HAL-query" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="HAL-query">HAL_query</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>HAL_query <span class="ot">&lt;-</span> <span class="cf">function</span>(id,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">date_min =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">date_max =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">format =</span> <span class="fu">c</span>(<span class="st">"csv"</span>, <span class="st">"bibtex"</span>, <span class="st">"json"</span>, <span class="st">"xml"</span>, <span class="st">"online"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">grouped =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type_id =</span> <span class="fu">c</span>(<span class="st">"person_id"</span>, <span class="st">"struct_id"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maxrows =</span> <span class="dv">1000</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">add_filters =</span> <span class="fu">list</span>(),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">add_exclusions =</span> <span class="fu">list</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">status_i =</span> <span class="dv">111</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">instance_s =</span> <span class="fu">c</span>(<span class="st">"sfo"</span>, <span class="st">"dumas"</span>, <span class="st">"memsic"</span>, <span class="st">"hceres"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">add_outputs =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sorted_by =</span> <span class="fu">c</span>(<span class="st">"producedDate_tdate"</span>, <span class="st">"desc"</span>),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">thesis_strict =</span> T) {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ----- DEFAULT PARAM -------------------------------------------------------</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  online <span class="ot">&lt;-</span> format[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="st">"online"</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  outputs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"docid"</span>, <span class="st">"halId_s"</span>, <span class="st">"version_i"</span>, <span class="st">"docType_s"</span>, <span class="st">"citationFull_s"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"citationRef_s"</span>, <span class="st">"publicationDate_tdate"</span>, <span class="st">"authFullNamePersonIDIDHal_fs"</span>, add_outputs</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  filters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">docType_s =</span> <span class="fu">c</span>(<span class="st">"COMM"</span>, <span class="st">"ART"</span>, <span class="st">"OUV"</span>, <span class="st">"COUV"</span>, <span class="st">"DOUV"</span>, <span class="st">"POSTER"</span>, <span class="st">"SOFTWARE"</span>, <span class="st">"THESE"</span>, <span class="st">"HDR"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  filters[<span class="fu">names</span>(add_filters)] <span class="ot">&lt;-</span> add_filters</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  exclusions <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  exclusions[<span class="fu">names</span>(add_exclusions)] <span class="ot">&lt;-</span> add_exclusions</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Url start</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (online) {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    start_query <span class="ot">&lt;-</span> <span class="st">"https://hal.archives-ouvertes.fr/search/index/?"</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    start_query <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://api.archives-ouvertes.fr/search/hal/"</span>, <span class="co"># API HAL</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"?omitHeader=true"</span>,                             <span class="co"># header ommited</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&amp;wt="</span>, format[[<span class="dv">1</span>]], <span class="st">"&amp;"</span>                        <span class="co"># csv, bibtex, ...</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (grouped) {</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    date_query <span class="ot">&lt;-</span> <span class="fu">query_date_grouped_parsing</span>(</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> id,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_id =</span> type_id,</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_min =</span> date_min,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_max =</span> date_max,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">online =</span> online</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    date_query <span class="ot">&lt;-</span> <span class="fu">query_date_ungrouped_parsing</span>(</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> id,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">type_id =</span> type_id,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_min =</span> date_min,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_max =</span> date_max,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">online =</span> online</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  filter_query <span class="ot">&lt;-</span> <span class="fu">query_filter_parsing</span>(</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">filters =</span> filters, <span class="at">exclusions =</span> exclusions,</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">online =</span> online</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (thesis_strict <span class="sc">&amp;</span> <span class="sc">!</span>online) {</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    add <span class="ot">&lt;-</span> <span class="st">"&amp;fq=NOT+(docType_s:(THESE+OR+HDR)+AND+submitType_s:(notice+OR+annex))"</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    add <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  sorting_query <span class="ot">&lt;-</span> <span class="fu">query_sort_parsing</span>(<span class="at">sorted_by =</span> sorted_by)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  output_query <span class="ot">&lt;-</span> <span class="fu">query_output_parsing</span>(</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">outputs =</span> outputs, <span class="at">n_row =</span> maxrows,</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">online =</span> online</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">urls =</span> <span class="fu">paste0</span>(</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>      start_query,</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      date_query,</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>      filter_query,</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>      add,</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>      sorting_query,</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>      output_query</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>      utils<span class="sc">::</span><span class="fu">URLencode</span>(),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">description =</span> <span class="fu">list</span>(</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">idhal =</span> id,</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_min =</span> date_min,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_max =</span> date_max,</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputs =</span> outputs,</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> format[[<span class="dv">1</span>]],</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">grouped =</span> grouped,</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxrows =</span> maxrows,</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">filters =</span> filters,</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">exclusions =</span> exclusions,</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputs =</span> outputs,</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">sorted_by =</span> sorted_by,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">thesis_strict =</span> thesis_strict</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(obj) <span class="ot">&lt;-</span> <span class="st">"halUrl"</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(obj)</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette fonction permet de créer une adresse url d’une requête à l’API HAL. Elle prend en entrée différents paramètres de spécification du rendu. Elle donne en sortie une URL.</p>
</section>
<section id="reseau-co-auteur" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="reseau-co-auteur">Script_R_reseau_co-auteur</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### ------------------- Creation of a co-authors</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">#### graph ------------------- ####</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">#### --------- First part : Data extraction and</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="do">#### cleaning</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>publication_id_struc <span class="ot">&lt;-</span> publication_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Publication_Year =</span> <span class="fu">substr</span>(publicationDate_tdate,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(publication_id_struc<span class="sc">$</span>structHasAlphaAuthIdHalPersonid_fs)) {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    publication_id_struc<span class="sc">$</span>structHasAlphaAuthIdHalPersonid_fs[i] <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span>, publication_id_struc<span class="sc">$</span>structHasAlphaAuthIdHalPersonid_fs[i])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction of info on the authors</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>data_graph_authors <span class="ot">&lt;-</span> publication_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(halId_s, Publication_Year, authFullNamePersonIDIDHal_fs) <span class="sc">%&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_rows</span>(authFullNamePersonIDIDHal_fs, <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(authFullNamePersonIDIDHal_fs, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Full_Name"</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Person_ID"</span>, <span class="st">"idhal"</span>), <span class="at">sep =</span> <span class="st">"_FacetSep_"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Full_Name, Person_ID, idhal), as.character)) <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Person_ID =</span> <span class="fu">ifelse</span>(Person_ID <span class="sc">==</span> <span class="st">"0"</span>, <span class="cn">NA</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        Person_ID))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction of info on which authors belongs to</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># which structure at the times of the</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># publications</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>data_graph_author_struc <span class="ot">&lt;-</span> publication_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(structHasAlphaAuthIdHalPersonid_fs) <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_rows</span>(structHasAlphaAuthIdHalPersonid_fs,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">"_AlphaSep_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(structHasAlphaAuthIdHalPersonid_fs, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"id_name_struc"</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id_full_name"</span>), <span class="at">sep =</span> <span class="st">"_JoinSep_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(id_full_name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"idhal_s"</span>, <span class="st">"Person_ID"</span>,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Full_Name"</span>), <span class="at">sep =</span> <span class="st">"_FacetSep_"</span>, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(id_name_struc, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"id_struc"</span>, <span class="st">"name_struc"</span>),</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">"_FacetSep_"</span>, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(Full_Name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Full_Name"</span>, <span class="st">"First_Letter"</span>),</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">","</span>, <span class="at">fill =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Person_ID =</span> <span class="fu">ifelse</span>(Person_ID <span class="sc">==</span> <span class="st">"0"</span>, <span class="cn">NA</span>,</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        Person_ID))</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="do">## data_graph_author_struc &lt;-</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="do">## find_inconsistent_names_and_ids(data_graph_author_struc)</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>data_graph_authors <span class="ot">&lt;-</span> <span class="fu">find_inconsistent_names_and_ids</span>(data_graph_authors)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>data_graph_authors <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_graph_authors, data_graph_author_struc[,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Person_ID"</span>, <span class="st">"id_struc"</span>)], <span class="at">by =</span> <span class="st">"Person_ID"</span>,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation of false ids only for authors without</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Person_ID addind a mark to know which one were</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># created and which were not</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>data_graph_authors<span class="sc">$</span>False_id_mark <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(data_graph_authors<span class="sc">$</span>Person_ID)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>unique_authors_without_id_vec <span class="ot">&lt;-</span> <span class="fu">unique</span>(data_graph_authors<span class="sc">$</span>Full_Name[<span class="fu">which</span>(data_graph_authors<span class="sc">$</span>False_id_mark <span class="sc">==</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="cn">FALSE</span>)])  <span class="do">##%&gt;%</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="do">## distinct(Full_Name, .keep_all = TRUE) ##%&gt;%</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="do">## filter(is.na(Person_ID))</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># to create my own ids</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>creation_id <span class="ot">&lt;-</span> <span class="cf">function</span>(unique_authors_no_id_name_column) {</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    ids <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="fu">length</span>(unique_authors_no_id_name_column))</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(unique_authors_no_id_name_column)) {</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        ids[i] <span class="ot">&lt;-</span> count</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ids)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>unique_authors_without_id <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Full_Name =</span> unique_authors_without_id_vec)</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>unique_authors_without_id<span class="sc">$</span>False_Id <span class="ot">=</span> <span class="fu">creation_id</span>(unique_authors_without_id<span class="sc">$</span>Full_Name)</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="co"># delete lines where False_Id equals Person_ID i</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="co"># lose info here but one person out of a</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co"># thousands seems ok (to be tested)</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>unique_authors_without_id <span class="ot">&lt;-</span> unique_authors_without_id <span class="sc">%&gt;%</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>False_Id <span class="sc">%in%</span> data_graph_authors<span class="sc">$</span>Person_ID)</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="co"># give a false id to all authors without person</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a><span class="co"># id</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>data_graph_authors <span class="ot">&lt;-</span> data_graph_authors <span class="sc">%&gt;%</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(unique_authors_without_id <span class="sc">%&gt;%</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(Full_Name, False_Id), <span class="at">by =</span> <span class="st">"Full_Name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Person_ID =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Person_ID), False_Id,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>        Person_ID)) <span class="sc">%&gt;%</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>False_Id, <span class="sc">-</span>idhal)</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a><span class="do">#### --------- Second part : Constructing and</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a><span class="do">#### visualizing networks</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the 'edge list' and the 'node list' To</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="co"># do so we first create the contingence matrix,</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="co"># and then we applied the melt function</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>contingence_table <span class="ot">=</span> data_graph_authors <span class="sc">%&gt;%</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="fu">as.numeric</span>(Person_ID), halId_s) <span class="sc">%&gt;%</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    table <span class="sc">%&gt;%</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>    as.matrix</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>contingence_matrix <span class="ot">=</span> contingence_table <span class="sc">%*%</span> <span class="fu">t</span>(contingence_table)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>contingence_matrix[<span class="fu">lower.tri</span>(contingence_matrix)] <span class="ot">=</span> <span class="dv">1000</span>  <span class="co"># We set 1000 in order to applied a filter later on (in order to avoid duplication with the melt function)</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>melt_matrix <span class="ot">=</span> <span class="fu">melt</span>(contingence_matrix)</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(melt_matrix) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"from"</span>, <span class="st">"to"</span>, <span class="st">"value"</span>)</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>edge_list <span class="ot">=</span> melt_matrix <span class="sc">%&gt;%</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(from <span class="sc">!=</span> to <span class="sc">&amp;</span> <span class="sc">!</span>value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">width =</span> value)</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">=</span> melt_matrix <span class="sc">%&gt;%</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(from <span class="sc">==</span> to) <span class="sc">%&gt;%</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>to) <span class="sc">%&gt;%</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">id =</span> from) <span class="sc">%&gt;%</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">label =</span> id)</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a group variable in the node_list in</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="co"># order to set differents colors corresponding</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a><span class="co"># with the different years</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>data_graph_authors<span class="sc">$</span>Publication_Year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(data_graph_authors<span class="sc">$</span>Publication_Year))</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>df_group <span class="ot">=</span> data_graph_authors <span class="sc">%&gt;%</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">group =</span> <span class="fu">as.character</span>(<span class="fu">floor</span>(<span class="fu">mean</span>(Publication_Year))),</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">.by =</span> Person_ID) <span class="sc">%&gt;%</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">id =</span> Person_ID)</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>node_list<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">as.character</span>(node_list<span class="sc">$</span>id)</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">=</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_group, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining nodes and edges that will serve to</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="co"># build a legend for edges and nodes sizes</span></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a><span class="co"># (number of publications), and colors (years)</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>range_year <span class="ot">=</span> <span class="fu">range</span>(data_graph_authors<span class="sc">$</span>Publication_Year)</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>node_size <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>,</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>, <span class="dv">15</span>), <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">group =</span> <span class="st">"Number of publications"</span>)</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>edge_size <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">to =</span> <span class="fu">c</span>(<span class="st">"B"</span>,</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C"</span>, <span class="st">"A"</span>), <span class="at">width =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">15</span>), <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"1"</span>,</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6"</span>, <span class="st">"15"</span>))</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>node_colors <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(range_year),</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="fu">as.character</span>(range_year), <span class="at">group =</span> <span class="fu">as.character</span>(range_year))</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>edge_colors <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">from =</span> <span class="fu">as.character</span>(range_year),</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">as.character</span>(range_year[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)]), <span class="at">width =</span> <span class="dv">1</span>,</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">""</span>)</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">=</span> <span class="fu">rbind</span>(node_list, node_size, node_colors)</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>edge_list <span class="ot">=</span> <span class="fu">rbind</span>(edge_list <span class="sc">%&gt;%</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">""</span>), edge_size, edge_colors)</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>edge_list <span class="ot">=</span> edge_list <span class="sc">%&gt;%</span></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining colors for Publication year</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>df_col <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="fu">as.character</span>(<span class="fu">c</span>(range_year[<span class="dv">1</span>]<span class="sc">:</span>range_year[<span class="dv">2</span>])),</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#35B779FF"</span>,</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#FDE725FF"</span>))(range_year[<span class="dv">2</span>] <span class="sc">-</span> range_year[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>))</span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">=</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_col, <span class="at">by =</span> <span class="st">"group"</span>)</span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend nodes Defining colors for Publication</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="co"># year</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>df_col_Legend <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">label =</span> <span class="fu">as.character</span>(<span class="fu">c</span>(range_year[<span class="dv">1</span>]<span class="sc">:</span>range_year[<span class="dv">2</span>])),</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">as.character</span>(<span class="fu">c</span>(range_year[<span class="dv">1</span>]<span class="sc">:</span>range_year[<span class="dv">2</span>])),</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#35B779FF"</span>,</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#FDE725FF"</span>))(range_year[<span class="dv">2</span>] <span class="sc">-</span> range_year[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>))</span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="co"># legend additional information table</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>node_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">info =</span> <span class="fu">c</span>(<span class="st">"Additional info for node A"</span>,</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Additional info for node B"</span>, <span class="st">"Additional info for node C"</span>))</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Join node_info with node_list to add the title</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a><span class="co"># column to the legend nodes</span></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(node_info, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(info), info, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>info)  <span class="co"># remove the info column after using it to create the title</span></span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert idhal to character type</span></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>cleaned_table <span class="ot">&lt;-</span> cleaned_table <span class="sc">%&gt;%</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">idhal =</span> <span class="fu">as.character</span>(idhal))</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> data_graph_authors[data_graph_authors<span class="sc">$</span>Person_ID <span class="sc">%in%</span></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>    node_list<span class="sc">$</span>id, ]</span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>node_info2 <span class="ot">&lt;-</span> tmp2 <span class="sc">%&gt;%</span></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Full_Name, Person_ID) <span class="sc">%&gt;%</span></span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">id =</span> Person_ID)</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Constructing node_info3</span></span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>tmp3 <span class="ot">&lt;-</span> cleaned_table[cleaned_table<span class="sc">$</span>idhal <span class="sc">%in%</span> node_list<span class="sc">$</span>id,</span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>node_info3 <span class="ot">&lt;-</span> tmp3 <span class="sc">%&gt;%</span></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(idhal, nom, prenom, unite, equipe) <span class="sc">%&gt;%</span></span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">id =</span> idhal)</span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining node_info2 with node_list to add the</span></span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a><span class="co"># title column</span></span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(node_info2, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title_info =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Full_Name), <span class="fu">paste</span>(<span class="st">"Name:"</span>,</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>        Full_Name, <span class="st">","</span>, <span class="st">"numeric idHal:"</span>, id), <span class="cn">NA</span>),</span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">ifelse</span>(title <span class="sc">==</span> <span class="st">""</span>, title_info, title))</span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Joining node_info3 with node_list to add the</span></span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a><span class="co"># title column</span></span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(node_info3, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title_info =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(nom), <span class="fu">paste</span>(<span class="st">"Name:"</span>,</span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(nom, prenom), <span class="st">","</span>, <span class="st">"Team:"</span>, equipe, <span class="st">","</span>,</span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Unit:"</span>, unite, <span class="st">","</span>, <span class="st">"numeric idHal:"</span>, id),</span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a>        title_info)) <span class="sc">%&gt;%</span></span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(nom), title_info,</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>        title)) <span class="sc">%&gt;%</span></span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>title_info)</span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(node_list<span class="sc">$</span>id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Network visualization</span></span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(node_list, edge_list, <span class="at">width =</span> <span class="st">"100%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visIgraphLayout</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visGroups</span>(<span class="at">groupname =</span> <span class="st">"Number of publications"</span>,</span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visLegend</span>(<span class="at">addNodes =</span> df_col_Legend, <span class="at">main =</span> <span class="st">"Graph of co-authors"</span>,</span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a>        <span class="at">useGroups =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visEdges</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visOptions</span>(<span class="at">selectedBy =</span> <span class="st">"equipe"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visExport</span>(<span class="at">type =</span> <span class="st">"jpeg"</span>, <span class="at">name =</span> <span class="st">"Full_Network_Co-authors_Example_managHAL"</span>,</span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Export as jpeg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce script permet la création d’un réseau de co-auteur à partir de données bibliographique HAL.</p>
</section>
<section id="reseau-unipart-bipart" class="level3 Sections">
<h3 class="Sections anchored" data-anchor-id="reseau-unipart-bipart">exemple_reseau_unipartite_bipartite</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'un réseau unipartite</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># Pour la reproductibilité </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>unipartite <span class="ot">&lt;-</span> <span class="fu">erdos.renyi.game</span>(<span class="dv">10</span>, <span class="fl">0.3</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># unipartite_graph &lt;- plot(unipartite, main =</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Réseau Unipartite', width = 800, height = 600)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(unipartite_graph)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>matrice_adjacence_unipartite <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(unipartite,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"adjacency"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Création d'un réseau bipartite Noms des nœuds</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>nodes_A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>nodes_B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span>, <span class="st">"B4"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des arêtes</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"B1"</span>, <span class="st">"A1"</span>, <span class="st">"B2"</span>, <span class="st">"A2"</span>, <span class="st">"B1"</span>, <span class="st">"A2"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B2"</span>, <span class="st">"A2"</span>, <span class="st">"B3"</span>, <span class="st">"A3"</span>, <span class="st">"B2"</span>, <span class="st">"A3"</span>, <span class="st">"B4"</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du graphe</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>bipartite <span class="ot">&lt;-</span> <span class="fu">graph</span>(edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(bipartite)<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">bipartite_mapping</span>(bipartite)<span class="sc">$</span>type</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bipartite, <span class="at">layout =</span> layout_as_bipartite, <span class="at">vertex.color =</span> <span class="fu">c</span>(<span class="st">"skyblue"</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"salmon"</span>)[<span class="fu">V</span>(bipartite)<span class="sc">$</span>type <span class="sc">+</span> <span class="dv">1</span>], <span class="at">vertex.label.color =</span> <span class="st">"black"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">vertex.shape =</span> <span class="st">"circle"</span>, <span class="at">vertex.size =</span> <span class="dv">30</span>, <span class="at">edge.width =</span> <span class="dv">2</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">"Réseau Bipartite"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>matrice_adjacence_bipartite <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(bipartite,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"adjacency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce script permet de créer les réseaux unipartites et bipartites présent dans les méthodes.</p>
</section>
<section id="Script-R-SBM-Full-Network" class="level3 section">
<h3 class="section anchored" data-anchor-id="Script-R-SBM-Full-Network">Script_R_SBM</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty adjacence matrix</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>matrice_adjacence <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(node_list<span class="sc">$</span>id),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="fu">length</span>(node_list<span class="sc">$</span>id))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(matrice_adjacence) <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(matrice_adjacence) <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in the adjacence matrix</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(edge_list)) {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">match</span>(edge_list<span class="sc">$</span>from[k], node_list<span class="sc">$</span>id)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="fu">match</span>(edge_list<span class="sc">$</span>to[k], node_list<span class="sc">$</span>id)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    matrice_adjacence[i, j] <span class="ot">&lt;-</span> edge_list<span class="sc">$</span>width[k]</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># deleting the legend lines</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>matrice_adjacence <span class="ot">&lt;-</span> matrice_adjacence[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(matrice_adjacence) <span class="sc">-</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>), ]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>matrice_adjacence <span class="ot">&lt;-</span> matrice_adjacence[, <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(matrice_adjacence) <span class="sc">-</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>)]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMyMatrix</span>(matrice_adjacence, <span class="at">dimLabels =</span> <span class="fu">list</span>(<span class="at">row =</span> <span class="st">"id"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"id"</span>))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation of a simple SBM using the adjacence</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>my_model <span class="ot">&lt;-</span> <span class="fu">estimateSimpleSBM</span>(matrice_adjacence, <span class="at">model =</span> <span class="st">"poisson"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimLabels =</span> <span class="fu">c</span>(<span class="st">"id"</span>))</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ne fonctionne pas sur quarto (l'acces au ancien</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plot)</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># creation graph avec attribution des groupes</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"C:/users/marti/OneDrive/Bureau/Stage/donnees_sbm.Rdata"</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>group_membership <span class="ot">&lt;-</span> <span class="fu">apply</span>(my_model<span class="sc">$</span>indMemberships,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, which.max)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>group_colors <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(group_membership))</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>df_col_group <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>, group_colors)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(node_list) <span class="sc">-</span> <span class="dv">5</span>), ]</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>df_col <span class="ot">=</span> <span class="fu">data.frame</span>(id <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id, group_membership <span class="ot">&lt;-</span> group_membership,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> df_col_group<span class="sc">$</span>group_colors[<span class="fu">apply</span>(my_model<span class="sc">$</span>indMemberships,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, which.max)])</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>node_list<span class="sc">$</span>group <span class="ot">=</span> df_col<span class="sc">$</span>group_membership....apply.my_model.indMemberships..<span class="dv">1</span>..which.max.</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>node_list<span class="sc">$</span>color <span class="ot">=</span> df_col<span class="sc">$</span>color</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Network visualization</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(node_list, edge_list, <span class="at">width =</span> <span class="st">"100%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visIgraphLayout</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visGroups</span>(<span class="at">groupname =</span> <span class="st">"Number of publications"</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visLegend</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visEdges</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visOptions</span>(<span class="at">selectedBy =</span> <span class="st">"color"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce script permet de réaliser un modèle en bloc stochastiques depuis le réseau créé dans l’annexe <a href="#reseau-co-auteur">Script_R_reseau_co-auteur</a>.</p>
</section>
<section id="Script-R-SBM-Partial-Network" class="level3 section">
<h3 class="section anchored" data-anchor-id="Script-R-SBM-Partial-Network">Script_R_Sous-groupe</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## test pour obtenir un sous groupe</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>find_info_author_associated_with_id_struc <span class="ot">&lt;-</span> <span class="cf">function</span>(data_frame_info_author_struc) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    data_info_author_associated_with_id_struc <span class="ot">&lt;-</span> data_frame_info_author_struc[data_frame_info_author_struc<span class="sc">$</span>id_struc <span class="sc">==</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1002311</span>, ]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(data_info_author_associated_with_id_struc)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> <span class="fu">find_info_author_associated_with_id_struc</span>(data_graph_author_struc)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>data_graph_author_struc<span class="sc">$</span>Full_Name[data_graph_author_struc<span class="sc">$</span>id_struc <span class="sc">==</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1002311</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> <span class="fu">unique</span>(data_test_info_author_id_struc)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">#### ------------------------------------------------------</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> data_test_info_author_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(Full_Name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"Nom"</span>, <span class="st">"Prenom"</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">extra =</span> <span class="st">"merge"</span>, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">fill =</span> <span class="st">"right"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> data_test_info_author_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">"Full_Name"</span>, Prenom, Nom, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>temp_cleaned_data_author <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>temp_cleaned_data_author<span class="sc">$</span>Full_Name <span class="ot">&lt;-</span> managHAL<span class="sc">:::</span><span class="fu">clean_names</span>(data_test_info_author_id_struc<span class="sc">$</span>Full_Name)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print inconsistent ids</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>inconsistent_ids <span class="ot">&lt;-</span> <span class="fu">find_inconsistent_ids</span>(data_test_info_author_id_struc)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(inconsistent_ids<span class="sc">$</span>Person_ID <span class="sc">&gt;</span> <span class="dv">1</span>)) {</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"Il y a "</span>, <span class="fu">length</span>(inconsistent_ids<span class="sc">$</span>Person_ID),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">" auteurs ayant leurs identifiant(s) HAL mal associé(s) à leurs noms :"</span>))</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(inconsistent_ids<span class="sc">$</span>Person_ID)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print inconsistent ids and names</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>inconsistent_names_ids <span class="ot">&lt;-</span> <span class="fu">find_inconsistent_names_ids</span>(data_test_info_author_id_struc)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(inconsistent_names_ids<span class="sc">$</span>Full_Name <span class="sc">&gt;</span> <span class="dv">1</span>)) {</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"Il y a "</span>, <span class="fu">length</span>(inconsistent_names_ids<span class="sc">$</span>Full_Name),</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">" Auteur ayant plusieurs formes auteurs ayant leurs identifiant(s) HAL mal associé(s) :"</span>))</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(inconsistent_names_ids<span class="sc">$</span>Full_Name)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Person_ID values in data_authors with</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># corresponding values from inconsistent_ids</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc<span class="sc">$</span>Person_ID <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_test_info_author_id_struc<span class="sc">$</span>Full_Name <span class="sc">%in%</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    inconsistent_ids<span class="sc">$</span>Full_Name, inconsistent_ids<span class="sc">$</span>Person_ID[<span class="fu">match</span>(data_test_info_author_id_struc<span class="sc">$</span>Full_Name,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    inconsistent_ids<span class="sc">$</span>Full_Name)], data_test_info_author_id_struc<span class="sc">$</span>Person_ID)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> <span class="fu">unique</span>(data_test_info_author_id_struc)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the temporary data.frame</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>temp_cleaned_data_author<span class="sc">$</span>Person_ID <span class="ot">&lt;-</span> data_test_info_author_id_struc<span class="sc">$</span>Person_ID</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="do">### 2nd version : via chatGPT</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(inconsistent_names_ids))) {</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">which</span>(temp_cleaned_data_author<span class="sc">$</span>Full_Name <span class="sc">==</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        inconsistent_names_ids<span class="sc">$</span>Full_Name[i])</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(idx) <span class="sc">==</span> i) {</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        temp_cleaned_data_author<span class="sc">$</span>Person_ID[idx] <span class="ot">&lt;-</span> inconsistent_names_ids<span class="sc">$</span>Person_ID[i]</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co"># My version : Replace Person_ID values in the</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co"># temporary dataframe for (i in</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="co"># seq_len(nrow(inconsistent_names_ids))) {</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co"># temp_cleaned_data_author[temp_cleaned_data_author$Full_Name</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="co"># == inconsistent_names_ids$Full_Name[i],</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Person_ID'] &lt;-</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co"># inconsistent_names_ids$Person_ID[i] } Replace</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Person_ID values in the original dataframe</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc<span class="sc">$</span>Person_ID <span class="ot">&lt;-</span> temp_cleaned_data_author<span class="sc">$</span>Person_ID</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="do">#### -----------------------------------------------------------</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="do">#### Create a logical vector for matching</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="do">#### Full_Name</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>match_vector <span class="ot">&lt;-</span> data_test_info_author_id_struc<span class="sc">$</span>Full_Name <span class="sc">%in%</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    node_list<span class="sc">$</span>Full_Name</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the match_vector to see which rows match</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(match_vector)</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign Person_ID where Full_Name matches</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>data_test_info_author_id_struc <span class="ot">&lt;-</span> data_test_info_author_id_struc <span class="sc">%&gt;%</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Person_ID =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Person_ID) <span class="sc">&amp;</span> Full_Name <span class="sc">%in%</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>        node_list<span class="sc">$</span>Full_Name, node_list<span class="sc">$</span>id[<span class="fu">match</span>(Full_Name,</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>        node_list<span class="sc">$</span>Full_Name)], Person_ID))</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the updated dataframe</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data_test_info_author_id_struc)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>node_list <span class="ot">&lt;-</span> node_list <span class="sc">%&gt;%</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(id <span class="sc">%in%</span> data_test_info_author_id_struc<span class="sc">$</span>Person_ID)</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter edge_list to keep only rows where both</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 'from' and 'to' are in</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="co"># data_test_info_author_id_struc$Person_ID</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>edge_list <span class="ot">&lt;-</span> edge_list <span class="sc">%&gt;%</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(from <span class="sc">%in%</span> data_test_info_author_id_struc<span class="sc">$</span>Person_ID <span class="sc">&amp;</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>        to <span class="sc">%in%</span> data_test_info_author_id_struc<span class="sc">$</span>Person_ID)</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Network visualization</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(node_list, edge_list, <span class="at">width =</span> <span class="st">"100%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visIgraphLayout</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visGroups</span>(<span class="at">groupname =</span> <span class="st">"Number of publications"</span>,</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visLegend</span>(<span class="at">addNodes =</span> df_col_Legend, <span class="at">main =</span> <span class="st">"Graph of Co-authors from MIA"</span>,</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">useGroups =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visEdges</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visOptions</span>(<span class="at">selectedBy =</span> <span class="st">"equipe"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visExport</span>(<span class="at">type =</span> <span class="st">"jpeg"</span>, <span class="at">name =</span> <span class="st">"Full_Network_Co-authors_Example_managHAL"</span>,</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Export as jpeg"</span>)</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="do">## visSave(selfcontained = TRUE, file =</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="do">## 'Partial_Network_Co-authors_Example_managHAL.html',</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a><span class="do">## background = 'white' )</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="do">## sbm Create an empty adjacence matrix</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>matrice_adjacence <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(node_list<span class="sc">$</span>id),</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="fu">length</span>(node_list<span class="sc">$</span>id))</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(matrice_adjacence) <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(matrice_adjacence) <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id</span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in the adjacence matrix</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(edge_list)) {</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">match</span>(edge_list<span class="sc">$</span>from[k], node_list<span class="sc">$</span>id)</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>    j <span class="ot">&lt;-</span> <span class="fu">match</span>(edge_list<span class="sc">$</span>to[k], node_list<span class="sc">$</span>id)</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>    matrice_adjacence[i, j] <span class="ot">&lt;-</span> edge_list<span class="sc">$</span>width[k]</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMyMatrix</span>(matrice_adjacence, <span class="at">dimLabels =</span> <span class="fu">list</span>(<span class="at">row =</span> <span class="st">"id"</span>,</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"id"</span>))</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation of a simple SBM using the adjacence</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a><span class="co"># matrix</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>my_model <span class="ot">&lt;-</span> <span class="fu">estimateSimpleSBM</span>(matrice_adjacence, <span class="at">model =</span> <span class="st">"poisson"</span>,</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimLabels =</span> <span class="fu">c</span>(<span class="st">"id"</span>))</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a><span class="co"># ne fonctionne pas sur quarto (l'acces au ancien</span></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a><span class="co"># plot)</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>my_model<span class="sc">$</span>nbBlocks</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>group_membership <span class="ot">&lt;-</span> <span class="fu">apply</span>(my_model<span class="sc">$</span>indMemberships,</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, which.max)</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>group_colors <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(group_membership))</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>df_col_group <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, group_colors)</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a><span class="do">## node_list &lt;- node_list[1:(nrow(node_list) -</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a><span class="do">## 5), ] la legnende non presente car selection</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="do">## labo</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>df_col <span class="ot">=</span> <span class="fu">data.frame</span>(id <span class="ot">&lt;-</span> node_list<span class="sc">$</span>id, group_membership <span class="ot">&lt;-</span> group_membership,</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> df_col_group<span class="sc">$</span>group_colors[<span class="fu">apply</span>(my_model<span class="sc">$</span>indMemberships,</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, which.max)])</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>node_list<span class="sc">$</span>group <span class="ot">=</span> df_col<span class="sc">$</span>group_membership....apply.my_model.indMemberships..<span class="dv">1</span>..which.max.</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>node_list<span class="sc">$</span>color <span class="ot">=</span> df_col<span class="sc">$</span>color</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Network visualization</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(node_list, edge_list, <span class="at">width =</span> <span class="st">"100%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visIgraphLayout</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visGroups</span>(<span class="at">groupname =</span> <span class="st">"Number of publications"</span>,</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visLegend</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visEdges</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">visOptions</span>(<span class="at">selectedBy =</span> <span class="st">"color"</span>)</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_model, <span class="at">type =</span> <span class="st">"expected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce script permet de créer un sous-groupe du réseau, de construire un modèle en bloc stochastique à partir de ce nouveau réseau et de visualiser le tout.</p>
</section>
</section>
<section id="bibliographie" class="level2">
<h2 class="anchored" data-anchor-id="bibliographie">BIBLIOGRAPHIE</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-aboutHAL" class="csl-entry" role="listitem">
<span>“About HAL.”</span> n.d. <a href="https://about.hal.science/">https://about.hal.science/</a>.
</div>
<div id="ref-science-ouverte" class="csl-entry" role="listitem">
AgroParisTech. 2024. <span>“Science Ouverte.”</span> <a href="https://www.agroparistech.fr/recherche/science-ouverte">https://www.agroparistech.fr/recherche/science-ouverte</a>.
</div>
<div id="ref-quarto" class="csl-entry" role="listitem">
Allaire, JJ, and Christophe Dervieux. 2024. <span>“Quarto: R Interface to ’Quarto’ Markdown Publishing System.”</span> <a href="https://CRAN.R-project.org/package=quarto">https://CRAN.R-project.org/package=quarto</a>.
</div>
<div id="ref-latent-block-models" class="csl-entry" role="listitem">
Aubert, J., P. Barbillon, S. Donnet, and V. Miele. 2022. <em>Using Latent Block Models to Detect Structure in Ecological Networks</em>. Wiley. <a href="https://doi.org/10.1002/9781119902799.ch6">https://doi.org/10.1002/9781119902799.ch6</a>.
</div>
<div id="ref-magrittr" class="csl-entry" role="listitem">
Bache, Stefan Milton, and Hadley Wickham. 2022. <span>“Magrittr: A Forward-Pipe Operator for r.”</span> <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>.
</div>
<div id="ref-future" class="csl-entry" role="listitem">
Bengtsson, Henrik. 2021. <span>“A Unifying Framework for Parallel and Distributed Processing in r Using Futures”</span> 13. <a href="https://doi.org/10.32614/RJ-2021-048">https://doi.org/10.32614/RJ-2021-048</a>.
</div>
<div id="ref-SnowballC" class="csl-entry" role="listitem">
Bouchet-Valat, Milan. 2023. <span>“SnowballC: Snowball Stemmers Based on the c ’Libstemmer’ UTF-8 Library.”</span> <a href="https://CRAN.R-project.org/package=SnowballC">https://CRAN.R-project.org/package=SnowballC</a>.
</div>
<div id="ref-chiquet2020" class="csl-entry" role="listitem">
Chiquet, Julien, Sophie Donnet, and Pierre Barbillon. 2020. <span>“Sbm: Stochastic Blockmodels.”</span> The R Foundation. <a href="https://doi.org/10.32614/cran.package.sbm">https://doi.org/10.32614/cran.package.sbm</a>.
</div>
<div id="ref-sbm" class="csl-entry" role="listitem">
———. 2024. <span>“Sbm: Stochastic Blockmodels.”</span> <a href="https://CRAN.R-project.org/package=sbm">https://CRAN.R-project.org/package=sbm</a>.
</div>
<div id="ref-api-hal" class="csl-entry" role="listitem">
<span>“Documentation API-HAL.”</span> n.d. <a href="https://api.archives-ouvertes.fr/docs/search/?#q">https://api.archives-ouvertes.fr/docs/search/?#q</a>.
</div>
<div id="ref-tm" class="csl-entry" role="listitem">
Feinerer, Ingo, and Kurt Hornik. 2024. <span>“Tm: Text Mining Package.”</span> <a href="https://CRAN.R-project.org/package=tm">https://CRAN.R-project.org/package=tm</a>.
</div>
<div id="ref-wordcloud" class="csl-entry" role="listitem">
Fellows, Ian. 2018. <span>“Wordcloud: Word Clouds.”</span> <a href="https://CRAN.R-project.org/package=wordcloud">https://CRAN.R-project.org/package=wordcloud</a>.
</div>
<div id="ref-tictoc" class="csl-entry" role="listitem">
Izrailev, Sergei. 2024. <span>“Tictoc: Functions for Timing r Scripts, as Well as Implementations of <span>"</span>Stack<span>"</span> and <span>"</span>StackList<span>"</span> Structures.”</span> <a href="https://CRAN.R-project.org/package=tictoc">https://CRAN.R-project.org/package=tictoc</a>.
</div>
<div id="ref-Moral-Muñoz2020" class="csl-entry" role="listitem">
Moral-Muñoz, José A., Enrique Herrera-Viedma, Antonio Santisteban-Espejo, and Manuel J. Cobo. 2020. <span>“Software Tools for Conducting Bibliometric Analysis in Science: An up-to-Date Review.”</span> <em>El Profesional de La Información</em>. <a href="https://doi.org/10.3145/epi.2020.ene.03">https://doi.org/10.3145/epi.2020.ene.03</a>.
</div>
<div id="ref-askpass" class="csl-entry" role="listitem">
Ooms, Jeroen. 2023. <span>“Askpass: Password Entry Utilities for r, Git, and SSH.”</span> <a href="https://CRAN.R-project.org/package=askpass">https://CRAN.R-project.org/package=askpass</a>.
</div>
<div id="ref-mailR" class="csl-entry" role="listitem">
Premraj, Rahul. 2021. <span>“mailR: A Utility to Send Emails from r.”</span> <a href="https://CRAN.R-project.org/package=mailR">https://CRAN.R-project.org/package=mailR</a>.
</div>
<div id="ref-furrr" class="csl-entry" role="listitem">
Vaughan, Davis, and Matt Dancho. 2022. <span>“Furrr: Apply Mapping Functions in Parallel Using Futures.”</span> <a href="https://CRAN.R-project.org/package=furrr">https://CRAN.R-project.org/package=furrr</a>.
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
Wickham, Hadley. 2016. <span>“Ggplot2: Elegant Graphics for Data Analysis.”</span> <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-stringr" class="csl-entry" role="listitem">
———. 2023. <span>“Stringr: Simple, Consistent Wrappers for Common String Operations.”</span> <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-rvest" class="csl-entry" role="listitem">
———. 2024. <span>“Rvest: Easily Harvest (Scrape) Web Pages.”</span> <a href="https://CRAN.R-project.org/package=rvest">https://CRAN.R-project.org/package=rvest</a>.
</div>
<div id="ref-readxl" class="csl-entry" role="listitem">
Wickham, Hadley, and Jennifer Bryan. 2023. <span>“Readxl: Read Excel Files.”</span> <a href="https://CRAN.R-project.org/package=readxl">https://CRAN.R-project.org/package=readxl</a>.
</div>
<div id="ref-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <span>“Dplyr: A Grammar of Data Manipulation.”</span> <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-purrr" class="csl-entry" role="listitem">
Wickham, Hadley, and Lionel Henry. 2023. <span>“Purrr: Functional Programming Tools.”</span> <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>